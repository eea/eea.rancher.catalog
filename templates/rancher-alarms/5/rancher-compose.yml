version: "2"
catalog:
  name: "Rancher Alarms"
  description: "Application to monitor Rancher Services"
  version: "1.4"
  uuid: "rancher-alarms-4"
  minimum_rancher_version: "v1.2.0"
  questions:
  - variable: "ALARM_POLL_INTERVAL"
    label: "Alarm poll interval"
    default: 60000
    description: "How often does the application poll rancher for services, default 60000 ms"
    type: "int"
  - variable: "ALARM_MONITOR_INTERVAL"
    label: "Alarm check interval"
    default: 15000
    description: "How often does the application poll services to check their status, default 15000ms"
    type: "int"
  - variable: "ALARM_MONITOR_HEALTHY_THRESHOLD"
    label: "Alarm healty checks threashold"
    default: 3
    description: "How many checks should the service be healty to close the alarm"
    type: "int"
  - variable: "ALARM_MONITOR_UNHEALTHY_THRESHOLD"
    label: "Alarm unhealty checks threashold"
    default: 3
    description: "How many checks should the service be unhealty to open the alarm"
    type: "int"
  - variable: "ALARM_FILTER"
    label: "Alarm filter"
    description: "What services should be monitored, ex app/*"
    type: "string"
  - variable: "ALARM_EMAIL_ADDRESSES"
    label: "Alarm email list"
    description: "To what emails should the alarms be sent - separated by semicolons (;)"
    type: "string"
  - variable: "ALARM_EMAIL_FROM"
    label: "Alarm email from"
    default: "Rancher Alarms <no-reply@eea.europa.eu>"
    description: "The from field on the alarms e.g. a noreply email"
    type: "string"
  - variable: "ALARM_EMAIL_SUBJECT"
    label: "Alarm email subject"
    default: "[#{environmentName}] #{healthyState}/#{monitorState} for #{stackName}/#{serviceName}"
    description: "The subject field on the alarms"
    type: "string"
  - variable: "ALARM_EMAIL_TEMPLATE"
    label: "Alarm email body"
    default: "Service #{stackName}/#{serviceName} became #{healthyState}/#{monitorState}. See stack: #{stackUrl}."
    description: "The body of the alarms"
    type: "multiline"
  - variable: "ALARM_SLACK_WEBHOOK_URL"
    label: "Alarm slack webhook url"
    description: "Slack webhook url - example: https://hooks.slack.com/services/YOUR_SLACK_UUID"
    type: "string"
  - variable: "ALARM_SLACK_CHANNEL"
    label: "Alarm slack channel"
    description: "Slack channel to post the alarms"
    type: "string"
  - variable: "ALARM_SLACK_BOTNAME"
    label: "Alarm slack botname"
    description: "Slack botname used to post the alarms"
    type: "string"
  - variable: "ALARM_SLACK_TEMPLATE"
    label: "Alarm slack template"
    default: "Service #{stackName}/#{serviceName} became #{healthyState}"
    description: "Alarm template in Slack "
    type: "multiline"
  - variable: "TZ"
    label: "Time zone"
    description: "Time zone"
    default: "Europe/Copenhagen"
    required: true
    type: "string"
  - variable: "POSTFIX_HOST"
    label: "Postfix hostname"
    type: "string"
    default: "rancher-alarms.eea.europa.eu"
    required: true
  - variable: "POSTFIX_RELAY"
    label: "Postfix relay"
    description: "Postfix SMTP relay"
    type: "string"
    default: "ironports.eea.europa.eu"
  - variable: "POSTFIX_PORT"
    label: "Postfix relay port"
    description: "Postfix SMTP relay port"
    type: "int"
    default: 8587
  - variable: "POSTFIX_USER"
    label: "Postfix user"
    description: "User used to send email"
    type: "string"
  - variable: "POSTFIX_PASS"
    label: "Postfix password"
    description: "Password used for MTP_USER"
    type: "password"

