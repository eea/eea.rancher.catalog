version: '2'
catalog:
  name: 'Volto - CLMS'
  description: 'Volto - CLMS: React-based frontend'
  version: '3.120.0'
  questions:
    - variable: 'HOST_LABELS'
      label: 'Schedule services on hosts with following host labels'
      description: 'Comma separated list of host labels (e.g. key1=value1,key2=value2) to use when scheduling the services.'
      type: 'string'
    - variable: 'BACKEND'
      label: 'Backend'
      description: 'Plone backend service'
      type: 'service'
      required: true
    - variable: 'API_PATH'
      label: 'API_PATH'
      description: 'Hosted website name, used as API_PATH variable'
      default: 'http://demo.eea.europa.eu/Plone'
      required: true
      type: 'string'
    - variable: 'INTERNAL_API_PATH'
      label: 'INTERNAL_API_PATH'
      description: 'Location of Plone site accessible from container'
      default: 'http://backend:8080/Plone'
      required: true
      type: 'string'
    - variable: 'SENTRY_URL'
      label: 'Sentry URL'
      description: 'Sentry URL'
      type: 'string'
      default: 'https://sentry.eea.europa.eu'
    - variable: 'SENTRY_AUTH_TOKEN'
      label: 'Sentry AUTH token'
      description: 'Authentication token for sentry'
      type: 'password'
      required: false
    - variable: 'SENTRY_ORG'
      label: 'Sentry organization'
      description: 'Name of the organization in sentry'
      default: 'eea'
      type: 'string'
    - variable: 'SENTRY_PROJECT'
      label: 'Sentry project'
      description: 'Name of the project in sentry'
      default: 'land-copernicus-eu'
      type: 'string'
      required: false
    - variable: 'SENTRY_DSN'
      label: 'Sentry DSN'
      description: 'Sentry client key. If set, Sentry error reporting and User feedback will be enabled. Default is plone-saas DSN.'
      type: 'string'
      required: false
    - variable: 'DEBUG'
      label: 'Debug'
      description: 'Enable frontend debugging'
      default: 'Yes'
      type: 'enum'
      options:
        - 'Yes'
        - 'No'
      required: true
    - variable: 'TZ'
      label: 'Time zone'
      description: 'Time zone'
      default: 'Europe/Copenhagen'
      type: 'string'
      required: true
    - variable: 'RAZZLE_MATOMO_SITE_ID'
      label: 'Matomo Site ID'
      description: 'Enter the Matomo Site ID for this site'
      default: ''
      type: 'string'
      required: true
    #  - variable: "RAZZLE_MATOMO_URL"
    #    label: "Matomo URL"
    #    description: "Enter the Matomo Service URL to use"
    #    default: "https://matomo.eea.europa.eu/"
    #    type: "string"
    #    required: true
    - variable: 'RAZZLE_DEMO_SITE'
      label: 'Is this a DEMO site?'
      description: 'true if it is, false if not'
      default: 'true'
      type: 'string'
      required: false
    - variable: 'RAZZLE_API_PATH'
      label: 'RAZZLE_API_PATH'
      description: 'Hosted website name, used as RAZZLE_API_PATH variable'
      default: 'https://clmsdemo.devel6cph.eea.europa.eu/api'
      type: 'string'
      required: true
    - variable: 'RAZZLE_INTERNAL_API_PATH'
      label: 'RAZZLE_INTERNAL_API_PATH'
      description: 'Location of Plone site accessible from container'
      default: 'http://backend:8080/Plone'
      type: 'string'
      required: true
    - variable: 'RAZZLE_DEV_PROXY_API_PATH'
      label: 'RAZZLE_DEV_PROXY_API_PATH'
      description: 'Enter the internal API path: name of the container in this stack that links to Plone'
      default: 'http://backend:8080/www'
      type: 'string'
      required: true
    - variable: 'CACHE_SIZE'
      label: 'Varnish cache size'
      description: 'Varnish cache size. e.g. 16G'
      default: '2G'
      type: 'string'
      required: true
    - variable: 'VARNISH_BERESP_TTL'
      label: 'Varnish object TTL (fresh)'
      description: 'https://docs.varnish-software.com/tutorials/object-lifetime/'
      type: 'string'
      default: '60s'
    - variable: 'VARNISH_BERESP_GRACE'
      label: 'Varnish object grace (stale)'
      description: 'https://docs.varnish-software.com/tutorials/object-lifetime/'
      type: 'string'
      default: '120s'
    - variable: 'VARNISH_BERESP_KEEP'
      label: 'Varnish object KEEP (used in conditional requests)'
      description: 'https://docs.varnish-software.com/tutorials/object-lifetime/'
      type: 'string'
      default: '120s'
    - variable: 'VARNISH_GZIP_ENABLED'
      label: 'Enable gzip on text & js content types'
      type: 'enum'
      default: 'false'
      required: true
      options:
        - 'false'
        - 'true'
    - variable: 'VARNISH_GZIP_JSON_ENABLED'
      label: 'Enable gzip on json content types'
      type: 'enum'
      default: 'false'
      required: true
      options:
        - 'false'
        - 'true'
    - variable: 'TRAEFIK_ENABLE'
      label: 'Traefik enabled'
      default: 'true'
      description: 'Choose true for configuring labels'
      type: 'enum'
      options:
        - 'true'
        - 'false'
      required: true
    - variable: 'TRAEFIK_URLS'
      description: 'Copernicus land url for traefik, in format `host.domain` or `host1.domain`, `host2.domain`'
      label: 'Hostname list for traefik'
      type: 'string'
      default: '`insitu`, `insitu2`'
    - variable: 'TRAEFIK_GEOBLOCK'
      description: 'List countries using iso 3166, separated by comma, no space'
      label: 'Geoblocked countries'
      type: 'string'
      default: 'RU,BY'
    - variable: 'TRAEFIK_PREFIX'
      label: 'Prefix for geoblock plugin configuration'
      description: 'this prefix should be different among all other services using Traefik '
      type: 'string'
      required: true
      default: 'clms-demo-'

services:
  frontend:
    health_check:
      response_timeout: 2000
      healthy_threshold: 2
      port: 3000
      unhealthy_threshold: 3
      initializing_timeout: 60000
      interval: 2000
      strategy: recreate
      reinitializing_timeout: 60000

  varnish:
    health_check:
      healthy_threshold: 1
      response_timeout: 10000
      port: 3000
      unhealthy_threshold: 8
      initializing_timeout: 90000
      interval: 20000
      strategy: recreate
      #      request_line: GET "/ok" "HTTP/1.0"
      reinitializing_timeout: 90000
